<!DOCTYPE html>
<html>
<head>
    <title>BTC Price & Indicators</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        body { 
            background: #000; 
            color: #fff; 
            font-family: Arial; 
            margin: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .price { 
            font-size: 48px; 
            text-align: center; 
            color: #00ff00; 
            margin: 20px;
        }
        .chart-container {
            background: #111;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .chart-title {
            text-align: center;
            font-size: 20px;
            margin-bottom: 20px;
            color: #00ff00;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="price" id="price">Loading...</div>
        
        <div class="chart-container">
            <div class="chart-title">Bitcoin Price - Last 2 Years</div>
            <canvas id="priceChart"></canvas>
        </div>
        
        <div class="chart-container">
            <div class="chart-title">Technical Indicators</div>
            <canvas id="indicatorChart"></canvas>
        </div>
    </div>

    <script>
        let priceChart, indicatorChart;

        // Calculate RSI
        function calculateRSI(prices, period = 14) {
            const changes = prices.slice(1).map((price, i) => price - prices[i]);
            const gains = changes.map(change => change > 0 ? change : 0);
            const losses = changes.map(change => change < 0 ? -change : 0);
            
            const rsi = Array(period).fill(null);
            let avgGain = gains.slice(0, period).reduce((a, b) => a + b) / period;
            let avgLoss = losses.slice(0, period).reduce((a, b) => a + b) / period;

            for (let i = period; i < prices.length; i++) {
                avgGain = (avgGain * (period - 1) + gains[i - 1]) / period;
                avgLoss = (avgLoss * (period - 1) + losses[i - 1]) / period;
                
                const rs = avgGain / avgLoss;
                rsi.push(100 - (100 / (1 + rs)));
            }
            return rsi;
        }

        // Calculate EMA
        function calculateEMA(prices, period) {
            const k = 2 / (period + 1);
            const ema = [prices[0]];
            
            for (let i = 1; i < prices.length; i++) {
                ema.push(prices[i] * k + ema[i - 1] * (1 - k));
            }
            return ema;
        }

        async function updatePrice() {
            try {
                const response = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
                const data = await response.json();
                document.getElementById('price').textContent = 
                    '$' + parseFloat(data.price).toLocaleString();
            } catch (error) {
                console.error('Price error:', error);
            }
        }

        async function updateCharts() {
            try {
                // Fetch 2 years of daily data (730 days)
                const response = await fetch('https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1d&limit=730');
                const data = await response.json();
                
                const prices = data.map(d => ({
                    x: new Date(d[0]),
                    y: parseFloat(d[4])
                }));

                // Calculate indicators
                const priceValues = prices.map(p => p.y);
                const rsi = calculateRSI(priceValues);
                const ema20 = calculateEMA(priceValues, 20);
                const ema50 = calculateEMA(priceValues, 50);

                // Update price chart
                if (priceChart) priceChart.destroy();
                const priceCtx = document.getElementById('priceChart').getContext('2d');
                
                priceChart = new Chart(priceCtx, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Bitcoin Price USD',
                            data: prices,
                            borderColor: '#00ff00',
                            borderWidth: 2,
                            tension: 0.4,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                grid: { color: '#333' },
                                ticks: { 
                                    color: '#fff',
                                    callback: value => '$' + value.toLocaleString()
                                }
                            },
                            x: {
                                type: 'time',
                                time: { unit: 'month' },
                                grid: { color: '#333' },
                                ticks: { color: '#fff' }
                            }
                        },
                        plugins: {
                            legend: { labels: { color: '#fff' } }
                        }
                    }
                });

                // Update indicator chart
                if (indicatorChart) indicatorChart.destroy();
                const indicatorCtx = document.getElementById('indicatorChart').getContext('2d');
                
                indicatorChart = new Chart(indicatorCtx, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'RSI',
                            data: rsi.map((value, index) => ({
                                x: prices[index].x,
                                y: value
                            })),
                            borderColor: '#ff0000',
                            borderWidth: 2,
                            yAxisID: 'rsi',
                            tension: 0.4,
                            pointRadius: 0
                        }, {
                            label: '20 EMA',
                            data: ema20.map((value, index) => ({
                                x: prices[index].x,
                                y: value
                            })),
                            borderColor: '#00ffff',
                            borderWidth: 2,
                            yAxisID: 'price',
                            tension: 0.4,
                            pointRadius: 0
                        }, {
                            label: '50 EMA',
                            data: ema50.map((value, index) => ({
                                x: prices[index].x,
                                y: value
                            })),
                            borderColor: '#ffff00',
                            borderWidth: 2,
                            yAxisID: 'price',
                            tension: 0.4,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            rsi: {
                                position: 'right',
                                grid: { color: '#333' },
                                ticks: { 
                                    color: '#fff'
                                },
                                min: 0,
                                max: 100
                            },
                            price: {
                                position: 'left',
                                grid: { color: '#333' },
                                ticks: { 
                                    color: '#fff',
                                    callback: value => '$' + value.toLocaleString()
                                }
                            },
                            x: {
                                type: 'time',
                                time: { unit: 'month' },
                                grid: { color: '#333' },
                                ticks: { color: '#fff' }
                            }
                        },
                        plugins: {
                            legend: { 
                                labels: { color: '#fff' },
                                position: 'top'
                            }
                        }
                    }
                });

            } catch (error) {
                console.error('Chart error:', error);
            }
        }

        // Make charts responsive
        document.querySelectorAll('canvas').forEach(canvas => {
            canvas.style.height = '400px';
        });

        // Initial load
        updatePrice();
        updateCharts();

        // Update every 10 seconds for price, every minute for charts
        setInterval(updatePrice, 10000);
        setInterval(updateCharts, 60000);
    </script>
</body>
</html>