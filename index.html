<!DOCTYPE html>
<html>
<head>
    <title>BTC Advanced Analytics</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .price {
            font-size: 48px;
            color: #00ff00;
            margin: 10px 0;
        }
        .change {
            font-size: 24px;
            margin: 10px 0;
        }
        .positive {
            color: #00ff00;
        }
        .negative {
            color: #ff4444;
        }
        .chart-container {
            background: #111;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .chart-title {
            text-align: center;
            font-size: 20px;
            margin-bottom: 20px;
            color: #00ff00;
        }
        .signals {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        .signal {
            background: #111;
            padding: 15px 25px;
            border-radius: 8px;
            text-align: center;
        }
        .buy {
            border: 2px solid #00ff00;
        }
        .sell {
            border: 2px solid #ff4444;
        }
        .neutral {
            border: 2px solid #888;
        }
        .indicator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .indicator-box {
            background: #111;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .indicator-label {
            color: #888;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .indicator-value {
            font-size: 20px;
            color: #00ff00;
        }
        canvas {
            min-height: 400px;
        }
        .settings-container {
            margin: 20px 0;
            text-align: center;
        }
        .settings-container input,
        .settings-container button {
            padding: 10px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="price" id="price">Loading...</div>
            <div class="change" id="change"></div>
        </div>

        <div class="settings-container">
            <input type="number" id="rsiPeriod" placeholder="RSI Period (default 14)" />
            <input type="number" id="bbPeriod" placeholder="BB Period (default 20)" />
            <input type="number" id="macdFast" placeholder="MACD Fast Period (default 12)" />
            <input type="number" id="macdSlow" placeholder="MACD Slow Period (default 26)" />
            <input type="number" id="macdSignal" placeholder="MACD Signal Period (default 9)" />
            <button onclick="updateData()">Update Analytics</button>
        </div>

        <div class="signals" id="signals"></div>

        <div class="chart-container">
            <div class="chart-title">Bitcoin Price with Bollinger Bands</div>
            <canvas id="priceChart"></canvas>
        </div>

        <div class="chart-container">
            <div class="chart-title">Volume</div>
            <canvas id="volumeChart"></canvas>
        </div>

        <div class="chart-container">
            <div class="chart-title">MACD</div>
            <canvas id="macdChart"></canvas>
        </div>
    </div>

    <script>
        async function fetchPriceData() {
            const response = await fetch('https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1d&limit=730');
            const data = await response.json();
            return data.map(d => ({
                time: new Date(d[0]),
                open: parseFloat(d[1]),
                high: parseFloat(d[2]),
                low: parseFloat(d[3]),
                close: parseFloat(d[4]),
                volume: parseFloat(d[5])
            }));
        }

        function calculateRSI(data, period = 14) {
            const gains = [];
            const losses = [];
            for (let i = 1; i < data.length; i++) {
                const change = data[i] - data[i - 1];
                if (change > 0) {
                    gains.push(change);
                    losses.push(0);
                } else {
                    gains.push(0);
                    losses.push(-change);
                }
            }
            const avgGain = gains.slice(0, period).reduce((a, b) => a + b, 0) / period;
            const avgLoss = losses.slice(0, period).reduce((a, b) => a + b, 0) / period;
            const rs = avgGain / avgLoss;
            const rsi = [100 - (100 / (1 + rs))];
            for (let i = period; i < data.length; i++) {
                const gain = gains[i];
                const loss = losses[i];
                const currentGain = ((avgGain * (period - 1)) + gain) / period;
                const currentLoss = ((avgLoss * (period - 1)) + loss) / period;
                const currentRS = currentGain / currentLoss;
                rsi.push(100 - (100 / (1 + currentRS)));
            }
            return rsi;
        }

        function calculateBollingerBands(data, period = 20, multiplier = 2) {
            const sma = data.map((_, idx, arr) => {
                if (idx < period) return null;
                const slice = arr.slice(idx - period, idx);
                return slice.reduce((a, b) => a + b, 0) / slice.length;
            });
            const stdDev = data.map((_, idx, arr) => {
                if (idx < period) return null;
                const slice = arr.slice(idx - period, idx);
                const avg = slice.reduce((a, b) => a + b, 0) / slice.length;
                return Math.sqrt(slice.reduce((sum, x) => sum + Math.pow(x - avg, 2), 0) / slice.length);
            });
            return {
                upper: sma.map((s, idx) => (s !== null ? s + stdDev[idx] * multiplier : null)),
                middle: sma,
                lower: sma.map((s, idx) => (s !== null ? s - stdDev[idx] * multiplier : null))
            };
        }

        async function updateData() {
            const prices = await fetchPriceData();
            const closePrices = prices.map(p => p.close);

            const rsiPeriod = parseInt(document.getElementById('rsiPeriod').value) || 14;
            const bbPeriod = parseInt(document.getElementById('bbPeriod').value) || 20;
            const macdFast = parseInt(document.getElementById('macdFast').value) || 12;
            const macdSlow = parseInt(document.getElementById('macdSlow').value) || 26;
            const macdSignal = parseInt(document.getElementById('macdSignal').value) || 9;

            const rsi = calculateRSI(closePrices, rsiPeriod);
            const bb = calculateBollingerBands(closePrices, bbPeriod);

            console.log('RSI:', rsi);
            console.log('Bollinger Bands:', bb);
        }

        updateData();
    </script>
</body>
</html>
